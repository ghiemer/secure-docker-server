# /root/server-setup/configs/sysctl.conf

# --- IP Spoofing & Source Routing Protection ---
# Enable IP spoofing protection, turn on source route verification
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# Disable Source Routing (packets shouldn't steer their own path)
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0

# --- ICMP / Redirects (Anti-MITM) ---
# Ignore ICMP redirects (prevents attackers from altering routing tables)
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# Do not send redirects
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# Ignore ICMP Echo Broadcast Requests (Smurf attack protection)
net.ipv4.icmp_echo_ignore_broadcasts = 1

# --- TCP/SYN Flood Protection ---
# Turn on SYN-cookies for protection against SYN flood attacks
net.ipv4.tcp_syncookies = 1
# Increase the TCP SYN backlog queue size
net.ipv4.tcp_max_syn_backlog = 2048
# Reduce the number of times the client tries to re-transmit the SYN-ACK
net.ipv4.tcp_synack_retries = 2

# --- Logging ---
# Log packets with impossible addresses to kernel log
net.ipv4.conf.all.log_martians = 1

# --- IPv6 Disabling (Security by Reduction) ---
# If not explicitly using IPv6, disable it to prevent bypasses
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1

# --- kernel/process security ---
# Restrict access to kernel logs
kernel.dmesg_restrict = 1
# Restrict access to eBPF (prevent malicious probing)
kernel.unprivileged_bpf_disabled = 1
